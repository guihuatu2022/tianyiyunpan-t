# 天翼云盘多账号自动签到脚本

一个基于腾讯云函数的天翼云盘多账号自动签到工具，支持随机时间签到、抽奖和结果通知，所有账号可在指定时间内完成签到。

## 功能特点

- **多账号支持**：同时管理多个天翼云盘账号，自动完成签到和抽奖
- **时间控制**：触发后5分钟内完成所有账号签到，适应云函数超时限制
- **结果通知**：支持邮件通知和WxPusher推送，汇总展示所有账号签到结果
- **自动容错**：网络异常时会记录错误状态，不影响其他账号执行
- **隐私保护**：日志中自动隐藏手机号中间四位，保护账号信息

## 准备工作

1. 腾讯云账号（需实名认证）
2. 天翼云盘账号（手机号+密码）
3. （可选）邮箱账号（用于接收通知，如QQ邮箱、163邮箱等）
4. （可选）WxPusher账号（用于微信消息推送）

## 安装部署步骤

### 步骤1：创建云函数

1. 登录[腾讯云控制台](https://console.cloud.tencent.com/)，进入「云函数 SCF」服务
2. 选择左侧「函数服务」，点击「新建」
3. 基础配置：
   - 函数名称：`tyy-signin`（可自定义）
   - 运行环境：`Python 3.9` 或更高版本
   - 创建方式：「空白函数」
   - 点击「下一步」

### 步骤2：上传代码

1. 在「函数代码」页面：
   - 代码提交方式：选择「本地上传文件夹」
   - 上传内容：包含 `index.py` 和 `layer.zip`（依赖层）的文件夹
   - 执行方法：`index.main_handler`（保持默认）
2. 点击「完成」创建函数

### 步骤3：配置依赖层（如果使用layer）

1. 进入函数详情页，选择左侧「层管理」
2. 点击「绑定层」，选择已上传的 `layer.zip` 依赖层
3. 点击「确定」完成绑定

### 步骤4：设置环境变量

1. 在函数详情页，选择「函数配置」
2. 下拉到「环境变量」，点击「编辑」
3. 添加以下必要变量：

| 变量名               | 说明                                                                 | 示例                                  |
|----------------------|----------------------------------------------------------------------|---------------------------------------|
| `ty_username`        | 天翼云盘账号（多个用`&`分隔）                                        | `158****5277&139****8888`            |
| `ty_password`        | 对应账号的密码（多个用`&`分隔，顺序需与账号一致）                    | `password1&password2`                 |

4. （可选）添加通知相关变量：

| 变量名               | 说明                                                                 | 示例                                  |
|----------------------|----------------------------------------------------------------------|---------------------------------------|
| `EMAIL_SMTP_SERVER`  | 邮箱SMTP服务器地址（QQ邮箱：`smtp.qq.com`，163邮箱：`smtp.163.com`） | `smtp.qq.com`                         |
| `EMAIL_SMTP_PORT`    | SMTP端口（通常为465）                                                | `465`                                 |
| `EMAIL_SENDER`       | 发件人邮箱地址                                                       | `sender@qq.com`                       |
| `EMAIL_PASSWORD`     | 邮箱授权码（非登录密码，需在邮箱设置中开启SMTP服务获取）             | `abcdefghijklmnop`                    |
| `EMAIL_RECEIVER`     | 收件人邮箱地址                                                       | `receiver@qq.com`                     |
| `WXPUSHER_APP_TOKEN` | WxPusher的AppToken（在WxPusher控制台获取）                           | `AT_XXXXXXXXXXXXXXXXXXXX`             |
| `WXPUSHER_UID`       | WxPusher的用户UID（多个用`&`分隔）                                   | `UID_XXXXXXXXXXXXXXXXXXXX&UID_YYYYYYYY` |

5. 点击「确定」保存环境变量

### 步骤5：配置触发器（定时执行）

1. 在函数详情页，选择左侧「触发器管理」
2. 点击「创建触发器」
3. 配置参数：
   - 触发方式：`定时触发`
   - 触发周期：`自定义触发周期`
   - Cron表达式：设置每天执行时间（例如 `0 0 9 * * *` 表示每天9点执行）
   - 点击「确定」

### 步骤6：测试运行

1. 在函数详情页，点击「测试」
2. 事件模板选择「默认测试事件」，点击「测试」
3. 查看「执行日志」，确认是否运行正常

## 常见问题

### 1. 签到失败提示"登录错误"

- 检查账号密码是否正确
- 确认账号未开启二次验证（脚本暂不支持验证码登录）
- 尝试手动登录天翼云盘官网，确认账号状态正常

### 2. 邮件发送失败

- 检查SMTP服务器和端口是否正确
- 确认授权码是否有效（QQ邮箱需在「设置-账户」中开启SMTP服务）
- 查看日志中的错误信息，根据提示调整配置

### 3. 部分账号超时被跳过

- 减少账号数量（建议不超过10个）
- 检查网络环境，确保云函数能正常访问天翼云盘API

### 4. 如何更新代码

1. 本地修改代码后，重新压缩为zip包
2. 进入函数详情页，在「函数代码」中上传新的zip包
3. 点击「部署」完成更新

## 许可证

本项目采用MIT许可证，详情参见LICENSE文件
